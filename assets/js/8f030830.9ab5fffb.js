"use strict";(self.webpackChunkkuby_docs=self.webpackChunkkuby_docs||[]).push([[618],{3905:function(e,n,t){t.d(n,{Zo:function(){return s},kt:function(){return m}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=o.createContext({}),d=function(e){var n=o.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},s=function(e){var n=d(e.components);return o.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},c=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),c=d(t),m=r,h=c["".concat(p,".").concat(m)]||c[m]||u[m]||a;return t?o.createElement(h,i(i({ref:n},s),{},{components:t})):o.createElement(h,i({ref:n},s))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=c;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<a;d++)i[d]=t[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}c.displayName="MDXCreateElement"},7857:function(e,n,t){t.r(n),t.d(n,{assets:function(){return s},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return u}});var o=t(7462),r=t(3366),a=(t(7294),t(3905)),i=["components"],l={id:"development",title:"Developing with Kuby",sidebar_label:"Developing with Kuby",slug:"/development"},p=void 0,d={unversionedId:"development",id:"development",title:"Developing with Kuby",description:'Kuby used to ship with a default environment called "development" that was capable of running your application locally using the copy of Kubernetes that comes with Docker Desktop.',source:"@site/docs/development.md",sourceDirName:".",slug:"/development",permalink:"/docs/development",editUrl:"https://github.com/getkuby/kuby-core/edit/master/docs/docs/development.md",tags:[],version:"current",frontMatter:{id:"development",title:"Developing with Kuby",sidebar_label:"Developing with Kuby",slug:"/development"},sidebar:"sidebar",previous:{title:"After the Deploy",permalink:"/docs/after-the-deploy"},next:{title:"Customizing the Docker Build",permalink:"/docs/customizing-docker-build"}},s={},u=[{value:"Testing with Kind",id:"testing-with-kind",level:2},{value:"Configuring the Kind Provider",id:"configuring-the-kind-provider",level:3},{value:"Sharing Configuration Between Environments",id:"sharing-configuration-between-environments",level:3}],c={toc:u};function m(e){var n=e.components,t=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,'Kuby used to ship with a default environment called "development" that was capable of running your application locally using the copy of Kubernetes that comes with ',(0,a.kt)("a",{parentName:"p",href:"https://www.docker.com/products/docker-desktop"},"Docker Desktop"),"."),(0,a.kt)("p",null,"Unfortunately it proved to be too difficult to maintain, so support was removed in version 0.12.0."),(0,a.kt)("h2",{id:"testing-with-kind"},"Testing with Kind"),(0,a.kt)("p",null,"While Kuby doesn't support developing your application inside Kubernetes, it does support deploying it to a local Kubernetes cluster for testing purposes using ",(0,a.kt)("a",{parentName:"p",href:"https://kind.sigs.k8s.io/"},"Kind"),"."),(0,a.kt)("p",null,"Kind is a tool that can easily create ephemeral Kubernetes clusters on-the-fly. The ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/getkuby/kuby-kind"},"kuby-kind")," gem features a Kuby provider that makes it a snap to deploy to a local cluster."),(0,a.kt)("h3",{id:"configuring-the-kind-provider"},"Configuring the Kind Provider"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"First, add the kuby-kind gem to your Gemfile and run ",(0,a.kt)("inlineCode",{parentName:"p"},"bundle install"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Create a development environment and configure Kind as the provider."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'kuby/kind'\n\nKuby.define('my-app') do\n  environment(:development) do\n    kubernetes do\n      provider :kind\n    end\n  end\nend\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Run setup"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bundle exec kuby -e development setup\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Deploy"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bundle exec kuby -e development deploy\n")))),(0,a.kt)("h3",{id:"sharing-configuration-between-environments"},"Sharing Configuration Between Environments"),(0,a.kt)("p",null,"To keep the code focused, the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker do ... end")," section was omitted from the example above. Let's look at a more complete example."),(0,a.kt)("p",null,"We could duplicate configuration from the production environment, but it would be nice if we could share it instead. Configuration sharing can be done with Ruby lambas and ",(0,a.kt)("inlineCode",{parentName:"p"},"instance_exec"),". For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},"Kuby.define('my-app') do\n  shared = -> do\n    docker do\n      image_url 'registry.gitlab.com/username/repo'\n\n      credentials do\n        # ...\n      end\n    end\n  end\n\n  environment(:production) do\n    instance_exec(&shared)\n\n    kubernetes do\n      # production provider\n      provider :linode do\n        # ...\n      end\n\n      add_plugin :rails_app do\n        hostname 'myapp.com'\n      end\n    end\n  end\n\n  environment(:development) do\n    instance_exec(&shared)\n\n    kubernetes do\n      # development provider\n      provider :kind\n\n      add_plugin :rails_app do\n        # make the app available via localhost\n        hostname 'localhost'\n        tls_enabled false\n      end\n    end\n  end\nend\n")),(0,a.kt)("p",null,"All the Docker config is defined in one place and applied to each environment."),(0,a.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Given the example code above, the Rails app should be available on localhost after being deployed to the local Kind cluster. If you'd rather use the production hostname instead (myapp.com in the example), you'll need to add an entry in your /etc/hosts file. It is also possible to use a tool like ",(0,a.kt)("inlineCode",{parentName:"p"},"curl")," by passing the ",(0,a.kt)("inlineCode",{parentName:"p"},"Host")," header, eg:"),(0,a.kt)("pre",{parentName:"div"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"curl -H 'Host: myapp.com' http://localhost\n")),(0,a.kt)("p",{parentName:"div"},"TLS certificates are not supported by kuby-kind."))))}m.isMDXComponent=!0}}]);