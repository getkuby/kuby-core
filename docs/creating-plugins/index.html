<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-creating-plugins">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kuby RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kuby Atom Feed"><title data-rh="true">Creating Your Own Plugins | Kuby</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://getkuby.io/docs/creating-plugins"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Creating Your Own Plugins | Kuby"><meta data-rh="true" name="description" content="Kuby features a plugin system that makes it easy to add your own functionality. In fact, much of Kuby&#x27;s own feature set is implemented as a series of plugins."><meta data-rh="true" property="og:description" content="Kuby features a plugin system that makes it easy to add your own functionality. In fact, much of Kuby&#x27;s own feature set is implemented as a series of plugins."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://getkuby.io/docs/creating-plugins"><link data-rh="true" rel="alternate" href="https://getkuby.io/docs/creating-plugins" hreflang="en"><link data-rh="true" rel="alternate" href="https://getkuby.io/docs/creating-plugins" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.fe22a523.css">
<link rel="preload" href="/assets/js/runtime~main.1b549b84.js" as="script">
<link rel="preload" href="/assets/js/main.b30adce0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Kuby Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Kuby Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Kuby</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://github.com/getkuby/kuby-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/raison-detre">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/customizing-docker-build">Customizing Kuby</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/customizing-docker-build">Customizing the Docker Build</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/understanding-kubernetes">Understanding Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/customizing-deployments">Customizing Deployments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/creating-plugins">Creating Your Own Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/environment-variables">Environment Variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/managing-secrets">Managing Secrets</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Customizing Kuby</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Creating Your Own Plugins</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Creating Your Own Plugins</h1></header><p>Kuby features a plugin system that makes it easy to add your own functionality. In fact, much of Kuby&#x27;s own feature set is implemented as a series of plugins.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="anatomy-of-a-plugin">Anatomy of a Plugin<a class="hash-link" href="#anatomy-of-a-plugin" title="Direct link to heading">‚Äã</a></h2><p>Plugins are just Ruby classes that inherit from <code>Kuby::Plugin</code>. The plugin interface, i.e. the methods plugins are expected to respond to, are summarized below.</p><ol><li><p><code>configure(&amp;block)</code>: Called when the plugin is added to a Kuby environment. In other words:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#403f53;background-color:#FBFBFB"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token plain">Kuby</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">define</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;my-app&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  environment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token symbol">:production</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    add_plugin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token symbol">:my_plugin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># at this point, the plugin&#x27;s `configure&#x27; method is called</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># and handed this block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><code>setup()</code>: Called during setup, i.e. whenever the <code>kuby setup</code> command is executed. Since <code>kuby setup</code> can be executed multiple times during the lifetime of an application (eg. when new plugins are added, etc), <code>#setup</code> routines should be idempotent.</p></li><li><p><code>remove()</code>: Should do the opposite of whatever <code>setup()</code> does. A plugin&#x27;s <code>#remove</code> routine is only invoked when the special <code>kuby plugin remove [plugin name]</code> command is executed.</p></li><li><p><code>resources()</code>: Returns an array of <code>KubeDSL::DSLObject</code> objects. See below for additional information regarding creating Kubernetes resource objects.</p></li><li><p><code>docker_images()</code>: Returns an array of <code>Kuby::Docker::Image</code> objects. These images will be built on <code>kuby build</code> and pushed on <code>kuby push</code>. See below for additional information regarding creating Docker images.</p></li><li><p><code>after_initialize()</code>: Called by the base <code>Kuby::Plugin#initialize</code> method. Designed to avoid forcing the plugin author call <code>super</code> in <code>#initialize</code>.</p></li><li><p><code>self.task_dirs()</code>: Returns an array of paths containing .rake files. Through this mechanism plugins can define Rake tasks that can be executed using the <code>kuby</code> command.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="registering-your-plugin">Registering Your Plugin<a class="hash-link" href="#registering-your-plugin" title="Direct link to heading">‚Äã</a></h2><p>Plugins must be registered with Kuby&#x27;s plugin system before they can be used. Register your plugin like so:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#403f53;background-color:#FBFBFB"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token plain">Kuby</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">register_plugin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token symbol">:my_plugin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> MyPlugin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="plugin-lifecycle-methods">Plugin Lifecycle Methods<a class="hash-link" href="#plugin-lifecycle-methods" title="Direct link to heading">‚Äã</a></h2><p>In addition to the methods described above, plugins should also respond to a series of lifecycle methods summarized below.</p><ol><li><code>after_configuration()</code>: Called after all plugins have been configured.</li><li><code>before_setup()</code>: Called before any plugins have been setup.</li><li><code>after_setup()</code>: Called after all plugins have been setup.</li><li><code>before_deploy(manifest)</code>: Called before deploying any resources. The <code>manifest</code> argument is an instance of <code>Kuby::Kubernetes::Manifest</code> and contains a list of all the Kubernetes resources Kuby intends to deploy.</li><li><code>after_deploy(manifest)</code>: Called after deploying all resources. The <code>manifest</code> argument is an instance of <code>Kuby::Kubernetes::Manifest</code> and contains a list of all the Kubernetes resources Kuby has just deployed.</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="creating-additional-kubernetes-resources">Creating Additional Kubernetes Resources<a class="hash-link" href="#creating-additional-kubernetes-resources" title="Direct link to heading">‚Äã</a></h2><p>Kuby uses <a href="https://github.com/getkuby/kube-dsl" target="_blank" rel="noopener noreferrer">KubeDSL</a> to define Kubernetes resources in Ruby code. KubeDSL is a complete representation of the Kubernetes schema, so it&#x27;s possible to create any kind of Kubernetes resource. For example, here&#x27;s how to create a Kubernetes &quot;config map&quot;. Config maps can be used to store bits of config data (or even the contents of entire files) that can be subsequently attached to pods and made available to your application:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#403f53;background-color:#FBFBFB"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token plain">KubeDSL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">config_map </span><span class="token keyword" style="color:rgb(12, 150, 155)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  metadata </span><span class="token keyword" style="color:rgb(12, 150, 155)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># The name of this config map. Must be unique within the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># given namespace.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    name </span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;my-config-map&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># This is how to get the name of the namespace your app runs in.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    namespace Kuby</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">environment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">kubernetes</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  data </span><span class="token keyword" style="color:rgb(12, 150, 155)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    add </span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;VAR_NAME&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;VAR_VALUE&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># etc, etc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>This config map object will be deployed if it is returned it from the <code>#resources</code> method in your plugin:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#403f53;background-color:#FBFBFB"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain"> Kuby</span><span class="token double-colon punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token plain">Plugin</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token method-definition function" style="color:rgb(153, 76, 195);font-style:italic">resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">config_map</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token method-definition function" style="color:rgb(153, 76, 195);font-style:italic">config_map</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token variable" style="color:rgb(201, 103, 101)">@config_map</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">||=</span><span class="token plain"> KubeDSL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">config_map </span><span class="token keyword" style="color:rgb(12, 150, 155)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># (see above)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="custom-resource-definitions-crds">Custom Resource Definitions (CRDs)<a class="hash-link" href="#custom-resource-definitions-crds" title="Direct link to heading">‚Äã</a></h2><p>A number of the plugins in the Kuby ecosystem contain DSL objects built from Custom Resource Definitions, or CRDs. CRDs are Kubernetes API extensions. They augment the set of objects in the Kubernetes API with custom ones defined by 3rd-party developers. For example, the CockroachDB Kubernetes operator defines a <code>CrdbCluster</code> object. The operator listens for objects of type <code>CrdbCluster</code> and acts accordingly, creating the necessary resources in the cluster to satisfy the object&#x27;s properties.</p><p>See the Rakefiles in <a href="https://github.com/getkuby/kuby-crdb" target="_blank" rel="noopener noreferrer">kuby-crdb</a> and <a href="https://github.com/getkuby/kuby-cert-manager" target="_blank" rel="noopener noreferrer">kuby-cert-manager</a> for examples of Kuby plugins that make use of DSL objects generated from CRDs.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="specifying-additional-docker-images">Specifying Additional Docker Images<a class="hash-link" href="#specifying-additional-docker-images" title="Direct link to heading">‚Äã</a></h2><p>As mentioned above, plugins can define additional Docker images that will be built and pushed on <code>kuby build</code> and <code>kuby push</code>, as well as listed in the output of <code>kuby dockerfiles</code>, etc.</p><p>In Kuby, Docker images are defined via classes that inherit from a subclass of <code>Kuby::Docker::Image</code>, most often <code>Kuby::Docker::TimestampedImage</code>. The <code>TimestampedImage</code> class versions images by using timestamped Docker tags. These tags can be programmatically ordered so as to know which image is the most recent, second most recent, etc.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="creating-a-dockerfile">Creating a Dockerfile<a class="hash-link" href="#creating-a-dockerfile" title="Direct link to heading">‚Äã</a></h3><p>Before creating an <code>Image</code> subclass, you&#x27;ll need to create a <code>Kuby::Docker::Dockerfile</code> instance. For a complete list of the supported directives, see the <a href="https://github.com/getkuby/kuby-core/blob/c4f5b1fd1d7cc6ff4532f7904b2462ce3e06d110/lib/kuby/docker/dockerfile.rb#L117" target="_blank" rel="noopener noreferrer">source code</a> in kuby-core.</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#403f53;background-color:#FBFBFB"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token plain">df </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> Kuby</span><span class="token double-colon punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token plain">Docker</span><span class="token double-colon punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">Dockerfile</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">df</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">from</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;ruby:3.1.0&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">df</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">cmd</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;ruby -e &quot;puts \&#x27;Hello, world!\&#x27;&quot;&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="creating-an-image">Creating an Image<a class="hash-link" href="#creating-an-image" title="Direct link to heading">‚Äã</a></h3><p>Next, create an instance of <code>TimestampedImage</code>:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#403f53;background-color:#FBFBFB"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token plain">image </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> Kuby</span><span class="token double-colon punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token plain">Docker</span><span class="token double-colon punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">TimestampedImage</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># the dockerfile instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  df</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># the registry URL for this image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;docker.pkg.github.com/&lt;username&gt;/&lt;repo&gt;/&lt;image-name&gt;&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># the Docker registry index URL, only needed if the Docker index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># and pull/push APIs are served using different URLs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">nil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># the tag to use</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;latest&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># an array of alias tags to tag the image with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string-literal string" style="color:rgb(72, 118, 214)">&#x27;foobar&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="exposing-the-image">Exposing the Image<a class="hash-link" href="#exposing-the-image" title="Direct link to heading">‚Äã</a></h3><p>Finally, return the image from your plugin:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#403f53;background-color:#FBFBFB"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">MyPlugin</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain"> Kuby</span><span class="token double-colon punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token plain">Plugin</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token method-definition function" style="color:rgb(153, 76, 195);font-style:italic">docker_images</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">def</span><span class="token plain"> </span><span class="token method-definition function" style="color:rgb(153, 76, 195);font-style:italic">image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token variable" style="color:rgb(201, 103, 101)">@image</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">||=</span><span class="token plain"> Kuby</span><span class="token double-colon punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token plain">Docker</span><span class="token double-colon punctuation" style="color:rgb(153, 76, 195)">::</span><span class="token class-name" style="color:rgb(17, 17, 17)">TimestampedImage</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic"># the code from above</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Running <code>bundle exec kuby -e production build</code> should now build your custom image as well as the usual ones.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/getkuby/kuby-core/edit/master/docs/docs/creating_plugins.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/customizing-deployments"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Customizing Deployments</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/environment-variables"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Environment Variables</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#anatomy-of-a-plugin" class="table-of-contents__link toc-highlight">Anatomy of a Plugin</a></li><li><a href="#registering-your-plugin" class="table-of-contents__link toc-highlight">Registering Your Plugin</a></li><li><a href="#plugin-lifecycle-methods" class="table-of-contents__link toc-highlight">Plugin Lifecycle Methods</a></li><li><a href="#creating-additional-kubernetes-resources" class="table-of-contents__link toc-highlight">Creating Additional Kubernetes Resources</a></li><li><a href="#custom-resource-definitions-crds" class="table-of-contents__link toc-highlight">Custom Resource Definitions (CRDs)</a></li><li><a href="#specifying-additional-docker-images" class="table-of-contents__link toc-highlight">Specifying Additional Docker Images</a><ul><li><a href="#creating-a-dockerfile" class="table-of-contents__link toc-highlight">Creating a Dockerfile</a></li><li><a href="#creating-an-image" class="table-of-contents__link toc-highlight">Creating an Image</a></li><li><a href="#exposing-the-image" class="table-of-contents__link toc-highlight">Exposing the Image</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Quick Start Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/why">Why Docker and Kubernetes?</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/getkuby" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/camertron" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 @camertron. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1b549b84.js"></script>
<script src="/assets/js/main.b30adce0.js"></script>
</body>
</html>